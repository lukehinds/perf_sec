<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>NFV Performance Security considerations</title>
<meta name="author" content="(Luke Hinds)"/>
<style type="text/css">
.underline { text-decoration: underline; }
</style>
<link rel="stylesheet" href="css/reveal.css"/>

<link rel="stylesheet" href="css/theme/moon.css" id="theme"/>

<!-- If the query includes 'print-pdf', include the PDF print sheet -->
<script>
            var link = document.createElement( 'link' );
            link.rel = 'stylesheet';
            link.type = 'text/css';
            link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
            document.getElementsByTagName( 'head' )[0].appendChild( link );
</script>
</head>
<body>
<div class="reveal">
<div class="slides">
<section id="sec-title-slide"><h1 class="title">NFV Performance Security</h1><h2 class="author">Luke Hinds</h2><p class="date">Principle Software Engineer, Red Hat</p>
</section>

<section>
<section id="slide-orgheadline1">
<h2 id="orgheadline1">Note before we start</h2>
<p>
NFV Security is a wide scoped topic, so for this talk I have focused in on the synergies with
NFV network peformance related functionality only.
</p>

<div class="org-src-container">

<pre  class="src src-bash"><span style="color: #2d9574;">"What about Disc encryption..?"</span> =  We are going to need another session!
</pre>
</div>

</section>
</section>
<section>
<section id="slide-orgheadline5">
<h2 id="orgheadline5">Security Risks in SRIOV</h2>
<ul>
<li>Mac Spoofing</li>
<li>Network Flow Control</li>
<li>Bandwidth Exhaustion</li>

</ul>

</section>
<section id="slide-orgheadline2">
<h3 id="orgheadline2">MAC Spoofing</h3>
<p>
Guests can assign their own MAC addreses, thereby allowing MAC spoofing..
</p>
</section>

<section>
<p>
This can be negated using the IP cmd..
</p>
<div class="org-src-container">
<pre  class="src src-bash">ip link set eth0 vf <span style="color: #a45bad;">3</span> mac xx:yy:xx:yy:xx:yy vlan <span style="color: #a45bad;">100</span> spoofchk on
</pre>
</div>

</section>

<section>
<p>
It can also be toggled in OpenStack neutron:
</p>

<div class="org-src-container">

<pre  class="src src-bash">stack@devstack:~/devstack$ neutron net-show net1
+---------------------------+--------------------------------------+
| Field                     | Value                                |
+---------------------------+--------------------------------------+
| admin_state_up            | True                                 |
| id                        | <span style="color: #a45bad;">725ebfa1-c3c3-43fa-b8c2-cac99f1f88fb</span> |
| mtu                       | <span style="color: #a45bad;">0</span>                                    |
| name                      | net1                                 |
| port_security_enabled     | True                                 |
| provider:network_type     | vxlan                                |
| provider:physical_network |                                      |
| provider:segmentation_id  | <span style="color: #a45bad;">1001</span>                                 |
| router:external           | False                                |
| shared                    | False                                |
| status                    | ACTIVE                               |
| subnets                   | <span style="color: #a45bad;">1d58d120-4990-41d8-b1f2-2354df54328a</span> |
| tenant_id                 | ba328cf9aa72429aad0535ec4adcd882     |
| vlan_transparent          | False                                |
+---------------------------+--------------------------------------+
</pre>
</div>
</section>

<section>
<p>
Why would you want disable it?
</p>
</section>

<section>
<p>
802.3ad (Dynamic link aggregation)
</p>
</section>

<section id="slide-orgheadline3">
<h3 id="orgheadline3">Network Flow Control</h3>
<p>
Flow Control exists to provide lossless layer 2 network communications
</p>
</section>
<section>
<p>
This enables a receiver to send a signal to the transmitter to pause traffic 
</p>
</section>
<section>
<p>
A `PAUSE` frame is sent to the transmitter whenever the receiver side runs out of buffers
</p>
</section>
<section>
<p>
SR-IOV enables multiple VFs to share a physical link on the host. 
</p>
<p>
(Average 256 VFs - single port NICs)
</p>
</section>

<section>
<p>
A malicious VM could cause temporary halt to the traffic of all VMs by manipulating flow control feature. 
</p>
</section>

<section>
<p>
At NIC side, the Ethernet flow control can be turned off&#x2026;
</p>
<div class="org-src-container">

<pre  class="src src-bash">ethtool -A &lt;PF ethX&gt; autoneg off rx off tx off
</pre>
</div>
</section>
<section>
<p>
Most NEPs hardware typically allow flow-control to be disabled (sometimes per port)
</p>
</section>
<section>
<p>
<b>Be Mindful:</b>
TCP incast (many-to-one communications)
</p>

</section>
<section id="slide-orgheadline4">
<h3 id="orgheadline4">Bandwidth Exhaustion</h3>
<p>
A single VNF consumes all bandwidth available to a physical link, denying other VFs
</p>
</section>
<section>
<p>
To avoid this, bandwidth limit can be set at the individual VF level as shown below:
</p>

<div class="org-src-container">

<pre  class="src src-bash">ip link set eth2 vf <span style="color: #a45bad;">0</span> rate <span style="color: #a45bad;">100</span> <span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">where rate is mentioned in Mbps</span>
</pre>
</div>
</section>
<section>
<p>
If the switch where the SR-IOV physical NIC is connected supports MAC based 
rate limiting, then the same restriction can be applied on switch side.
</p>
</section>
<section>

<p>
In OpenStack this can be as a QoS policy
</p>

<div class="org-src-container">

<pre  class="src src-bash">$ neutron qos-bandwidth-limit-rule-create bw-limiter --max-kbps <span style="color: #a45bad;">3000</span> <span style="color: #2d9574;">\</span>
  --max-burst-kbps <span style="color: #a45bad;">300</span>

Created a new bandwidth_limit_rule:
+----------------+--------------------------------------+
| Field          | Value                                |
+----------------+--------------------------------------+
| id             | <span style="color: #a45bad;">92ceb52f-170f-49d0-9528-976e2fee2d6f</span> |
| max_burst_kbps | <span style="color: #a45bad;">300</span>                                  |
| max_kbps       | <span style="color: #a45bad;">3000</span>                                 |
+----------------+--------------------------------------+
</pre>
</div>


</section>
</section>
<section>
<section id="slide-orgheadline8">
<h2 id="orgheadline8">DPDK</h2>
<p>
Data-Plane-Development-Kit Security considerations
</p>

</section>
<section id="slide-orgheadline6">
<h3 id="orgheadline6">Multi Process Limit in DPDK</h3>
<p>
The multi-process feature requires that the exact same hugepage memory mappings be present 
in all applications.
</p>
</section>
<section>
<ul>
<li>The Linux security feature - Address-Space Layout Randomization (ASLR) can interfere with this mapping.</li>

<li>VNF vendors may request to disable this feature in order to run multi-process applications.</li>

</ul>
</section>
<section>

<p>
Disabling Address-Space Layout Randomization (ASLR) may have security implications, so disable only
when these have been understood.
</p>

<p>
<a href="http://dpdk.org/doc/guides/prog_guide/multi_proc_support.html">http://dpdk.org/doc/guides/prog_guide/multi_proc_support.html</a> 
</p>

</section>
<section id="slide-orgheadline7">
<h3 id="orgheadline7">Pause Frame Exploit</h3>
<p>
Pause frame exploits are currently not possible, due to flow controls being disabled in DPDK 
</p>

<p>
<a href="http://seclists.org/oss-sec/2015/q4/425">http://seclists.org/oss-sec/2015/q4/425</a>
</p>

</section>
</section>
<section>
<section id="slide-orgheadline11">
<h2 id="orgheadline11">Open vSwitch</h2>
<p>
Open vSwitch Security considerations
</p>

</section>
<section id="slide-orgheadline9">
<h3 id="orgheadline9">Use OVS PKI</h3>
<p>
Protect against flow table export or manipulation with TLS protection
</p>

<p>
<a href="http://openvswitch.org/support/dist-docs/INSTALL.SSL.md.html">http://openvswitch.org/support/dist-docs/INSTALL.SSL.md.html</a>
</p>

</section>
<section id="slide-orgheadline10">
<h3 id="orgheadline10">QoS</h3>
<p>
Rate Limiting can be set for Open vSwitch instances:
</p>

<ul>
<li>ingress-policing-rate:</li>

</ul>
<p>
Max rate (Kbps)  a VM is allowed to send.
</p>
<ul>
<li>ingress-policing-burst:</li>

</ul>
<p>
Max burst allowed.
</p>

<p>
For example:
</p>

<div class="org-src-container">

<pre  class="src src-bash">ovs-vsctl set interface tap0 <span style="color: #7590db;">ingress_policing_rate</span>=<span style="color: #a45bad;">1000</span>
ovs-vsctl set interface tap0 <span style="color: #7590db;">ingress_policing_burst</span>=<span style="color: #a45bad;">100</span>
</pre>
</div>

</section>
<section>

<p>
Which as we saw earlier, is also exposed to OpenStack Neutron&#x2026;
</p>

</section>
<section>

<div class="org-src-container">

<pre  class="src src-bash">$ neutron qos-bandwidth-limit-rule-create bw-limiter --max-kbps <span style="color: #a45bad;">3000</span> <span style="color: #2d9574;">\</span>
  --max-burst-kbps <span style="color: #a45bad;">300</span>

Created a new bandwidth_limit_rule:
+----------------+--------------------------------------+
| Field          | Value                                |
+----------------+--------------------------------------+
| id             | <span style="color: #a45bad;">92ceb52f-170f-49d0-9528-976e2fee2d6f</span> |
| max_burst_kbps | <span style="color: #a45bad;">300</span>                                  |
| max_kbps       | <span style="color: #a45bad;">3000</span>                                 |
+----------------+--------------------------------------+
</pre>
</div>


</section>
</section>
<section>
<section id="slide-orgheadline12">
<h2 id="orgheadline12">SDN Controllers</h2>
</section>
<section>

<p>
Rate Limit Northbound Rest API of SDN Controllers to prevent overload of HTTP requests
</p>

</section>
<section>

<p>
Be mindful of southbound packet storms on the userplane. 
</p>

</section>
<section>

<p>
Use Network Segregation / Security Zones for Control and Data Plane traffic
</p>

</section>
</section>
<section>
<section id="slide-orgheadline13">
<h2 id="orgheadline13">The End.</h2>
<p>
Questions&#x2026;?
</p>
</section>
</section>
</div>
</div>
<script src="lib/js/head.min.js"></script>
<script src="js/reveal.js"></script>

<script>

            // More info https://github.com/hakimel/reveal.js#configuration
            Reveal.initialize({
                controls: true,
                progress: true,
                history: false,
                center: true,
                slideNumber: 'nil',
                rollingLinks: false,
                keyboard: true,
                overview: true,

                transition: 'slide', // none/fade/slide/convex/concave/zoom

                // More info https://github.com/hakimel/reveal.js#dependencies
                dependencies: [
                    { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
                    { src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                    { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                    { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
                    { src: 'plugin/zoom-js/zoom.js', async: true },
                    { src: 'plugin/notes/notes.js', async: true }
                ]
            });
        </script>
</body>
</html>
